<ui:composition template="/templates/layout.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:lance="http://java.sun.com/jsf/composite/lance"
	xmlns:uilance="http://vah.com.br/lance">
	<ui:define name="metadata">
		<f:metadata>
			<f:viewParam name="id" value="#{userController.id}" />
			<f:viewParam name="editing" value="#{userController.editing}" />
			<f:viewAction action="#{userController.onLoad}" />
		</f:metadata>
	</ui:define>
	<ui:define name="content">
		<h:form id="form">
			<lance:editForm id="contractPnl" controller="#{userController}"
				columns="3">
				<uilance:inputText id="name" label="Login"
					value="#{userController.item.login}"
					editing="#{userController.editing}" required="true" />
				<f:facet name="other">
					<h:panelGrid columns="2" columnClasses="td-align-top">
						<p:panel id="addServicePnl" header="Serviços">
							<h:panelGrid columns="3" rendered="#{userController.editing}">
								<uilance:selectOne id="serviceSelectOne" label="Serviço"
									value="#{userController.serviceIdToAdd}" editing="true"
									rendered="#{userController.editing}" required="false"
									renderMessage="false">
									<f:selectItems value="#{userController.services}" />
									<p:ajax update="addServiceBtn" process="@this serviceSelectOne" />
								</uilance:selectOne>
								<p:commandButton id="addServiceBtn"
									action="#{userController.addService}" ajax="true"
									update="addServicePnl serviceSelectOne" value="Adicionar"
									process="@this serviceSelectOne"
									disabled="#{userController.serviceIdToAdd == null}" />
							</h:panelGrid>
							<table>
								<ui:repeat id="servicesRepeat" var="service"
									value="#{userController.item.services}" varStatus="iter">
									<tbody>
										<tr>
											<td>
												<h:outputText value="#{service.title}" />
											</td>
											<td>
												<p:commandButton id="removeBtn"
													action="#{userController.removeService(iter.index)}"
													ajax="true" update=":#{p:component('addServicePnl')}"
													rendered="#{userController.editing}" validateClient="false"
													value="Remover" process="@this" />
											</td>
										</tr>
									</tbody>
								</ui:repeat>
							</table>
						</p:panel>
						<p:panel id="rolesPnl" header="Perfis">
							<h:panelGrid columns="3" rendered="#{userController.editing}">
								<uilance:selectOne id="roleSelectOne" label="Perfil"
									value="#{userController.roleToAdd}" editing="true"
									rendered="#{userController.editing}" required="false"
									renderMessage="false">
									<f:selectItems value="#{userController.roles}" />
									<p:ajax update="addRoleBtn" process="@this roleSelectOne" />
								</uilance:selectOne>
								<p:commandButton id="addRoleBtn"
									action="#{userController.addRole}" ajax="true"
									update="rolesPnl roleSelectOne" value="Adicionar"
									process="@this roleSelectOne"
									disabled="#{userController.roleToAdd == null}" />
							</h:panelGrid>
							<table>
								<ui:repeat id="rolesRepeat" var="role"
									value="#{userController.item.roles.toArray()}" varStatus="iter">
									<tbody>
										<tr>
											<td>
												<h:outputText value="#{role.label}" />
											</td>
											<td>
												<p:commandButton id="removeBtn"
													action="#{userController.removeRole(iter.index)}"
													ajax="true" update=":#{p:component('rolesPnl')}"
													rendered="#{userController.editing}" validateClient="false"
													value="Remover" process="@this" />
											</td>
										</tr>
									</tbody>
								</ui:repeat>
							</table>
						</p:panel>
					</h:panelGrid>

				</f:facet>
			</lance:editForm>
		</h:form>
	</ui:define>
</ui:composition>