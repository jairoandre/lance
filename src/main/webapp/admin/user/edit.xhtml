<ui:composition template="/templates/layout.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:vah="http://java.sun.com/jsf/composite/vah"
                xmlns:uivah="http://vah.com.br/vah">
  <ui:define name="metadata">
    <f:metadata>
      <f:viewParam name="id" value="#{userCtrl.id}"/>
      <f:viewAction action="#{userCtrl.onLoad}"/>
    </f:metadata>
  </ui:define>
  <ui:define name="content">
    <h:form id="form">

      <vah:manyToManyDialog id="addServiceDlg"
                              bean="#{userCtrl.beanServico}"
                              controller="#{servicoCtrl}" header="RELACIONAR SERVIÇOS"
                              targetController="#{userCtrl}"
                              targetItems="#{userCtrl.item.servicos}"
                              toggleAction="toggleService" update="servicos" width="800"/>
      <vah:editForm id="contractPnl" controller="#{userCtrl}"
                      columns="3">
        <uivah:inputText id="name" label="Login"
                           value="#{userCtrl.item.login}"
                           editing="#{userCtrl.editing}"/>
        <uivah:inputText id="title" label="Descrição"
                           value="#{userCtrl.item.title}"
                           editing="#{userCtrl.editing}"/>

        <f:facet name="other">
          <h:panelGroup id="servicesPnl" layout="block" styleClass="margin-top">
            <uivah:manyToMany id="servicos" addBtnLabel="Relacionar serviços"
                                bean="#{userCtrl.beanServico}" columnHeader="Serviço"
                                controller="#{userCtrl}" dialog="addServiceDlg"
                                editing="#{userCtrl.editing}"
                                emptyMessage="Sem serviços relacionados"
                                items="#{userCtrl.item.servicos}"
                                toggleAction="toggleService"/>
          </h:panelGroup>

          <h:panelGroup id="rolesContainer" layout="block" styleClass="margin-top">
            <p:dataTable id="roles" value="#{userCtrl.roles}" var="role">
              <p:column style="text-align: center;" width="50">
                <p:commandLink ajax="true"
                               action="#{userCtrl.toggleRole(role)}"
                               styleClass="action-link" process="@this"
                               update=":#{p:component('rolesContainer')}">
                  <h:panelGroup
                    styleClass="fa fa#{userCtrl.item.roles.contains(role) ? '-check' : ''}-square-o"/>
                </p:commandLink>
              </p:column>
              <p:column headerText="Perfil" styleClass="left-align">
                <h:outputText value="#{role.label}"/>
              </p:column>
            </p:dataTable>
          </h:panelGroup>

        </f:facet>
      </vah:editForm>
    </h:form>
  </ui:define>
</ui:composition>