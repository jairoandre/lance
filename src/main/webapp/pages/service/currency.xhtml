<ui:composition template="/templates/layout.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:lance="http://java.sun.com/jsf/composite/lance"
                xmlns:uilance="http://vah.com.br/lance">
  <ui:define name="metadata">
    <f:metadata>
      <f:viewParam name="id" value="#{serviceController.id}"/>
      <f:viewAction action="#{serviceController.onLoad}"/>
    </f:metadata>
  </ui:define>
  <ui:define name="content">
    <h:form id="form">

      <lance:editForm id="serviceForm" controller="#{serviceController}"
                      columns="3">

        <uilance:inputText id="serviceTitle" label="Serviço"
                           value="#{serviceController.item.title}" editing="false"
                           rendered="false"/>

        <f:facet name="other">

          <p:fieldset id="newValueFieldset" legend="Novo Valor"
                      rendered="#{serviceController.editing}">
            <h:panelGrid id="addServiceGrid" columns="3">
              <uilance:inputDate id="beginDate" label="Data de início"
                                 value="#{serviceController.serviceValue.beginDate}"
                                 required="true"
                                 editing="true"/>

              <uilance:inputCurrency id="outPeakValue" label="Tarifa fora de ponta" required="true"
                                     value="#{serviceController.serviceValue.value}" editing="true"
                                     rendered="#{serviceController.item.type == 'E' or serviceController.item.type == 'CRE'}"/>
              <uilance:inputPercentage id="outPeakPercent" label="% Hora fora de ponta" required="true"
                                     value="#{serviceController.serviceValue.valueA}" editing="true"
                                     rendered="#{serviceController.item.type == 'E' or serviceController.item.type == 'CRE'}">
                <p:ajax event="change" listener="#{serviceController.updatePeakValue}" process="@this" update="peakPercent"/>
              </uilance:inputPercentage>
              <uilance:inputCurrency id="peakValue" label="Tarifa de ponta" required="true"
                                     value="#{serviceController.serviceValue.valueB}" editing="true"
                                     rendered="#{serviceController.item.type == 'E' or serviceController.item.type == 'CRE'}"/>
              <uilance:inputPercentage id="peakPercent" label="% Hora de ponta" required="true"
                                     value="#{serviceController.serviceValue.valueC}" editing="true"
                                     rendered="#{serviceController.item.type == 'E' or serviceController.item.type == 'CRE'}"/>
              <uilance:inputCurrency id="value" label="Valor" required="true"
                                     value="#{serviceController.serviceValue.value}" editing="true"
                                     rendered="#{serviceController.item.type == 'T'}"/>

              <uilance:inputPercentage id="vahPercent" label="Percentual VAH" required="true"
                                       value="#{serviceController.serviceValue.valueD}" editing="true"
                                       rendered="#{serviceController.item.type == 'CR' or serviceController.item.type == 'CP' or serviceController.item.type == 'CRE'}"/>
              <uilance:inputPercentage id="thirdsPercent" label="Percentual Terceiros" required="true"
                                       value="#{serviceController.serviceValue.valueE}" editing="true"
                                       rendered="#{serviceController.item.type == 'CR' or serviceController.item.type == 'CP' or serviceController.item.type == 'CRE'}"/>
              <uilance:inputPercentage id="consultingRoomsPercent" label="Percentual Consultórios" required="true"
                                       value="#{serviceController.serviceValue.valueF}" editing="true"
                                       rendered="#{serviceController.item.type == 'CR' or serviceController.item.type == 'CP' or serviceController.item.type == 'CRE'}"/>
              <uilance:inputPercentage id="shoopingPercent" label="Percentual Shopping" required="true"
                                       value="#{serviceController.serviceValue.valueG}" editing="true"
                                       rendered="#{serviceController.item.type == 'CR' or serviceController.item.type == 'CP' or serviceController.item.type == 'CRE'}"/>
              <p:commandButton id="btnAddValue" value="Adicionar"
                               action="#{serviceController.addValue}" ajax="true" validateClient="true"
                               process=":#{p:component('newValueFieldset')}"
                               update=":#{p:component('valuesDataTable')} addServiceGrid"/>
            </h:panelGrid>
          </p:fieldset>

          <br/>

          <ui:include src="values.xhtml"/>

        </f:facet>

      </lance:editForm>


    </h:form>
  </ui:define>
</ui:composition>