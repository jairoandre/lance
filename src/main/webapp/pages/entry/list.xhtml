<ui:composition
  template="/templates/layout.xhtml"
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:p="http://primefaces.org/ui"
  xmlns:lance="http://java.sun.com/jsf/composite/lance">
  <ui:define name="content">
    <h:form id="form">
      <p:panel header="Lançamentos">
        <p:outputLabel value="Vigência:" styleClass="label"/>
        <h:panelGroup id="searchMonthPnl" styleClass="margin-left">
          <p:inputText id="searchMonth" styleClass="searchMonth" value="#{entryController.searchMonth}">
            <f:convertDateTime pattern="MM/yyyy" dateStyle="short"/>
          </p:inputText>
          <script>
            $(".searchMonth").mask('99/9999');
          </script>
        </h:panelGroup>
        <p:commandButton id="searchMonthBtn" action="#{entryController.filterByDate}" value="Filtrar" ajax="true"
                         process="@this searchMonth" update="dataTable"
                         icon="fa fa-search" styleClass="margin-left"/>

        <p:dataTable id="dataTable" value="#{entryController.entries}" styleClass="margin-top"
                     var="entry" emptyMessage="Sem entradas" rowIndexVar="index">
          <p:column headerText="Serviço" styleClass="left-align">
            <h:outputText value="#{entry.service.title}"/>
          </p:column>
          <p:column headerText="Valor lançado" styleClass="left-align" width="150">
            <h:outputText value="#{entry.totalValue}">
              <f:convertNumber minFractionDigits="2" pattern="R$ #,##0.00"/>
            </h:outputText>
          </p:column>
          <p:column headerText="Criação" styleClass="left-align" width="100">
            <h:outputText value="#{entry.createdOn}"
                          rendered="#{entry.status != 'N'}">
              <f:convertDateTime pattern="dd/MM/yyyy"/>
            </h:outputText>
            <h:outputText value="-" rendered="#{entry.status == 'N'}"/>
          </p:column>
          <p:column headerText="Vigência" styleClass="left-align" width="100">
            <h:outputText value="#{entry.effectiveOn}"
                          rendered="#{entry.effectiveOn != null}">
              <f:convertDateTime pattern="MM/yyyy"/>
            </h:outputText>
            <h:outputText value="-"
                          rendered="#{entry.effectiveOn == null}"/>
          </p:column>
          <p:column headerText="Estado" styleClass="left-align" width="100">
            <lance:entryStatus status="#{entry.status}"/>
          </p:column>
          <p:column headerText="Ações" width="100" styleClass="action-link">
            <p:commandLink id="detailEntry"
                           action="#{entryController.detail(entry)}">
              <span class="fa fa-search"/>
            </p:commandLink>
            <lance:toolTip id="tooltipDetailEntry" for="#{p:component('detailEntry')}"
                           value="Detalhar #{cc.attrs.controller.entityName}" index="#{indexVar}"/>
            <span/>
            <h:panelGroup rendered="#{loginController.isUserInRoles('ADMINISTRATOR,MANAGER')}">
              <p:commandLink id="editEntry"
                             action="#{entryController.edit(entry)}">
                <span class="fa fa-pencil"/>
              </p:commandLink>
              <lance:toolTip id="tooltipEditEntry" for="#{p:component('editEntry')}"
                             value="Editar #{cc.attrs.controller.entityName}" index="#{indexVar}"/>
              <span/>
            </h:panelGroup>
            <h:panelGroup rendered="#{loginController.isUserInRoles('ADMINISTRATOR,SUPERVISOR')}">
              <p:commandLink id="validateEntry"
                             action="#{entryController.validate(entry)}"
                             disabled="#{entry.status != 'L' and entry.status != 'F' and entry.status != 'M'}">
                <span class="fa fa-gavel"/>
              </p:commandLink>
              <lance:toolTip id="tooltipValidateEntry" for="#{p:component('validateEntry')}"
                             value="Validar #{cc.attrs.controller.entityName}" index="#{indexVar}"/>
              <span/>
            </h:panelGroup>
            <h:panelGroup rendered="#{loginController.isUserInRoles('ADMINISTRATOR,ACCOUNTANT')}">
              <p:commandLink id="sendEditEntry"
                             action="#{entryController.edit(entry)}"
                             disabled="#{entry.status != 'V'}">
                <span class="fa fa-calculator"/>
              </p:commandLink>
              <lance:toolTip id="tooltipSendEditEntry" for="#{p:component('sendEditEntry')}"
                             value="Emitir #{cc.attrs.controller.entityName}" index="#{indexVar}"/>
            </h:panelGroup>
          </p:column>
        </p:dataTable>
      </p:panel>
    </h:form>
  </ui:define>
</ui:composition>