<ui:composition template="/templates/layout.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui">
  <ui:define name="content">
    <h:form id="form">
      <p:panel header="Balanço Contábil">
        <h:panelGrid columns="2">
          <p:outputLabel value="Período" for="range" styleClass="lance-label"/>
          <h:panelGroup id="range">
            <p:calendar id="begin" value="#{balancoContabilCtrl.range[0]}"/>
            <h:outputText value="à"/>
            <p:calendar id="end" value="#{balancoContabilCtrl.range[1]}"/>
          </h:panelGroup>
          <p:outputLabel value="Serviços" for="servicos" styleClass="lance-label"/>
          <p:autoComplete id="servicos" value="#{servicoCtrl.itemToAdd}"
                          widgetVar="servicos"
                          queryDelay="200"
                          var="item"
                          itemLabel="#{item.labelForSelectItem}"
                          itemValue="#{item}"
                          onclick="this.setSelectionRange(0, this.value.length)"
                          converter="#{servicoConverter}"
                          inputStyleClass="lance-input"
                          completeMethod="#{servicoCtrl.completeMethod}"
                          placeholder="Nº./Nome...">
            <p:ajax event="itemSelect" listener="#{servicoCtrl.addItem(balancoContabilCtrl.servicos)}"
                    process="@this"
                    update="list" oncomplete="$(PF('servicos').jqId + '_input').val('')"/>
            <p:column width="75">
              #{item.id}
            </p:column>
            <p:column>
              #{item.title}
            </p:column>
          </p:autoComplete>
        </h:panelGrid>

        <h:panelGroup id="list" styleClass="list list-block-wrapper" layout="block">
          <ui:repeat value="#{balancoContabilCtrl.servicos.toArray()}" var="it">
            <h:panelGroup layout="block"
                          styleClass="list-block margin-top #{it.systemAdded ? 'list-block--novo' : ''}">
              <p:commandLink styleClass="fa fa-close"
                             action="#{servicoCtrl.removeItem(balancoContabilCtrl.servicos, it)}"
                             process="@this" update="@(.list)">
              </p:commandLink>
              <h:outputText value="#{it.labelForSelectItem} #{it.systemAdded ? '(NOVO)' : ''}"/>
            </h:panelGroup>
          </ui:repeat>
        </h:panelGroup>

        <h:panelGroup layout="block" styleClass="margin-top">
          <p:commandButton rendered="true" id="gerarRelatorio" value="Gerar Relatório" ajax="false"
                           process="@form"
                           style="font-size: 25px;"
                           onclick="PrimeFaces.monitorDownload(start, stop);">
            <p:fileDownload value="#{balancoContabilCtrl.relatorio}"/>
          </p:commandButton>
        </h:panelGroup>
      </p:panel>

      <script type="text/javascript">
        function start() {
          PF('changePage').show();
        }

        function stop() {
          PF('changePage').hide();
        }
      </script>

    </h:form>
  </ui:define>
</ui:composition>